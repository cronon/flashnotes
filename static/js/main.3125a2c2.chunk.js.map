{"version":3,"sources":["stave.tsx","note.ts","Roll.tsx","App.tsx","index.tsx"],"names":["Stave","note","ref","useRef","useEffect","VF","Vex","Flow","vf","Factory","renderer","elementId","score","EasyScore","System","addStave","voices","voice","notes","toString","setMode","Voice","Mode","SOFT","addClef","draw","current","svg","querySelector","remove","className","id","notesNumber","Note","midi","str","accidental","this","letter","Math","floor","s","length","playing","withAudio","cb","audio","document","Error","startNote","find","p","eq","push","currentTime","play","endNote","_","last","pause","playNote","a","Promise","res","setTimeout","keyToNote","key","65","87","83","69","68","70","84","71","89","72","85","74","75","79","76","80","186","fromString","Roll","onKey","keyDown","e","keyCode","classList","add","keyUp","window","addEventListener","removeEventListener","mouseDown","useCallback","target","noteStr","dataset","then","onMouseDown","data-key","data-note","App","useState","setNote","result","setResult","played","nextNote","fromNumber","random","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.3125a2c2.chunk.js","sourcesContent":["import react, { useEffect, useRef } from 'react';\nimport Vex from 'vexflow';\nimport { Note } from './note';\n\nexport function Stave({note}: {note: Note}) {\n    const ref = useRef<HTMLDivElement>(null);\n    useEffect(() => {\n        const VF = Vex.Flow;\n        // Create a VexFlow renderer attaced to the DIV element \"boo\"\n        const vf = new VF.Factory({renderer: {elementId: 'stave'}});\n        var score = vf.EasyScore();\n        var system = vf.System();\n    \n        // Create a 4/4 treble stave, and add two parallel voices\n        const stave =  system.addStave({\n            voices: [\n                score.voice(score.notes(note.toString()), {}).setMode(VF.Voice.Mode.SOFT)\n            ]\n        });\n        stave.addClef('treble');\n\n        // Draw it!\n        vf.draw();\n        return () => {\n            if (ref.current) {\n                const svg = ref.current.querySelector('svg')\n                svg && svg.remove();\n            }\n        }\n    }, [note])\n    return <div className=\"stave\" id=\"stave\" ref={ref}>\n\n    </div>\n}","import _ from 'lodash';\nimport { resolve } from 'path';\n\nconst notesNumber: any = {\n    'C': 1,\n    'C#': 2,\n    'Db': 2,\n    'D': 3,\n    'D#': 4,\n    'Eb': 4,\n    'E': 5,\n    'F': 6,\n    'F#': 7,\n    'Gb': 7,\n    'G': 8,\n    'G#': 9,\n    'Ab': 9,\n    'A': 10,\n    'A#': 11,\n    'Bb': 11,\n    'B': 12,\n}\n\nexport function randomNote(): Note {\n    return Note.fromNumber(_.random(60, 72))\n}\n\nexport class Note {\n    static fromNumber(midi: number) {\n        const letters = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n        const letter = letters[midi % 12];\n        const octave = Math.floor(midi / 12) - 1;\n        const accidental = letter[1] || null;\n        return new Note(midi, letter + octave, accidental);\n    }\n\n    static fromString(s: string) {\n        const note = s.length === 3 ? s[0] + s[1] : s[0];\n        const noteNumber = notesNumber[note] - 1;\n        const octave = +s[s.length - 1];\n        const midi = (noteNumber) + 12*(octave + 1);\n        const accidental = (s[1] === 'b' || s[1] === '#') ? s[1] : null;\n        return new Note(midi, s, accidental);\n    }\n    constructor(public midi: number, public str: string, public accidental: string | null) {}\n\n    eq(note: Note) {\n        return this.midi === note.midi;\n    }\n\n    toString() {\n        return this.str;\n    }\n}\n\n\nlet playing: Note[] = [];\nfunction withAudio(note: Note, cb: (audio: HTMLAudioElement) => void) {\n    const audio: HTMLAudioElement | null = document.querySelector(`audio[data-note=\"${note.toString()}\"]`);\n    if (audio) {\n        cb(audio);\n    } else {\n        throw new Error('Cannot find <audio> for note ' + note.toString());\n    }\n}\nexport function startNote(note: Note) {\n    withAudio(note, audio => {\n        if (!playing.find(p => p.eq(note))) {\n            playing.push(note);\n            audio.currentTime = 0;\n            audio.play();\n        }\n    });\n}\nexport function endNote(note?: Note) {\n    note = note || _.last(playing);\n    if (note) {\n        withAudio(note, audio => {\n            audio.currentTime = 0;\n            audio.pause();\n            _.remove(playing, p => p.eq(note!));\n        });\n    }\n}\nexport async function playNote(note: Note): Promise<void> {\n    startNote(note);\n    return new Promise(res => {\n        setTimeout(() => {\n            endNote(note)\n            res();\n        }, 500)\n    })\n}","import _ from 'lodash';\nimport react, { useCallback, useEffect } from 'react';\nimport { endNote, Note, playNote, startNote } from './note';\nimport './Roll.css';\n\nfunction keyToNote(key: number) {\n    const keyMap: any = {\n        65: \"C4\",\n        87: \"C#4\",\n        83: \"D4\",\n        69: \"D#4\",\n        68: \"E4\",\n        70: \"F4\",\n        84: \"F#4\",\n        71: \"G4\",\n        89: \"G#4\",\n        72: \"A4\",\n        85: \"A#4\",\n        74: \"B4\",\n        75: \"C5\",\n        79: \"C#5\",\n        76: \"D5\",\n        80: \"D#5\",\n        186: \"E5\",\n    }\n    const res = keyMap[key];\n    if (res) return Note.fromString(res);\n    else throw new Error('Undefined key pressed ' + key)\n}\nlet mouseNote: Note | null = null;\nexport function Roll({onKey}: {onKey: (e: Note) => void} ) {\n    useEffect(() => {\n        window.addEventListener(\"keydown\", keyDown);\n        window.addEventListener('keyup', keyUp);\n\n        function keyDown(e: KeyboardEvent) {\n            const key = document.querySelector(`.key[data-key=\"${e.keyCode}\"]`);\n            if (!key) return;\n            key.classList.add(\"playing\");\n            startNote(keyToNote(e.keyCode))\n        }\n        function keyUp(e: KeyboardEvent) {\n            const key: any = document.querySelector(`.key[data-key=\"${e.keyCode}\"]`);\n            if (!key) return;\n            key.classList.remove(\"playing\");\n            const note = keyToNote(e.keyCode);\n            endNote(note)\n            onKey(note)\n        }\n        return () => {\n            window.removeEventListener(\"keydown\", keyDown);\n            window.removeEventListener('keyup', keyUp);\n        }\n    }, [onKey]);\n\n    const mouseDown = useCallback(function (e: any) {\n        const target = e.target as HTMLElement;\n        const noteStr = target.dataset.note\n        if (noteStr) {\n            const note = Note.fromString(noteStr);\n            startNote(note);\n            target.classList.add('playing');\n            mouseNote = note;\n            playNote(note).then(() => {\n                target.classList.remove('playing')\n                onKey(note);\n            });\n        }\n    }, [onKey]);\n\n    return (\n<section id=\"main\">\n    <div className=\"nowplaying\"></div>\n    <div className=\"keys\" onMouseDown={mouseDown}>\n      <div data-key=\"65\" className=\"key\" data-note=\"C4\">\n          <span className=\"hints\">A</span>\n      </div>\n      <div data-key=\"87\" className=\"key sharp\" data-note=\"C#4\">\n          <span className=\"hints\">W</span>\n      </div>\n      <div data-key=\"83\" className=\"key\" data-note=\"D4\">\n          <span className=\"hints\">S</span>\n      </div>\n      <div data-key=\"69\" className=\"key sharp\" data-note=\"D#4\">\n          <span className=\"hints\">E</span>\n      </div>\n      <div data-key=\"68\" className=\"key\" data-note=\"E4\">\n          <span className=\"hints\">D</span>\n      </div>\n      <div data-key=\"70\" className=\"key\" data-note=\"F4\">\n          <span className=\"hints\">F</span>\n      </div>\n      <div data-key=\"84\" className=\"key sharp\" data-note=\"F#4\">\n          <span className=\"hints\">T</span>\n      </div>\n      <div data-key=\"71\" className=\"key\" data-note=\"G4\">\n          <span className=\"hints\">G</span>\n      </div>\n      <div data-key=\"89\" className=\"key sharp\" data-note=\"G#4\">\n          <span className=\"hints\">Y</span>\n      </div>\n      <div data-key=\"72\" className=\"key\" data-note=\"A4\">\n          <span className=\"hints\">H</span>\n      </div>\n      <div data-key=\"85\" className=\"key sharp\" data-note=\"A#4\">\n          <span className=\"hints\">U</span>\n      </div>\n      <div data-key=\"74\" className=\"key\" data-note=\"B4\">\n          <span className=\"hints\">J</span>\n      </div>\n      <div data-key=\"75\" className=\"key\" data-note=\"C5\">\n          <span className=\"hints\">K</span>\n      </div>\n      <div data-key=\"79\" className=\"key sharp\" data-note=\"C#5\">\n          <span className=\"hints\">O</span>\n      </div>\n      <div data-key=\"76\" className=\"key\" data-note=\"D5\">\n          <span className=\"hints\">L</span>\n      </div>\n      <div data-key=\"80\" className=\"key sharp\" data-note=\"D#5\">\n          <span className=\"hints\">P</span>\n      </div>\n      <div data-key=\"186\" className=\"key\" data-note=\"E5\">\n          <span className=\"hints\">;</span>\n      </div>\n    </div>\n</section>)\n}\n\n","import React, { useCallback, useEffect, useState } from 'react';\nimport './App.css';\nimport { Stave } from './stave';\nimport {Note, playNote, randomNote} from './note';\nimport { Roll } from './Roll';\n\nfunction App() {\n  const [note, setNote] = useState(Note.fromString('C4'));\n  const [result, setResult] = useState('?');\n  useEffect(() => {\n    playNote(note);\n  }, [note]);\n  const onKey = useCallback((played: Note) => {\n    if (played.eq(note)) {\n      setResult(note.toString());\n      setTimeout(() => {\n        setResult('?');\n        const nextNote = randomNote();\n        setNote(nextNote)\n      }, 500)\n    }\n  }, [note])\n  return (\n    <div className=\"App\">\n      <Stave note={note}/>\n      <h1>{result}</h1>\n      <Roll onKey={onKey} />\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);"],"sourceRoot":""}