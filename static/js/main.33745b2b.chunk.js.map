{"version":3,"sources":["stave.tsx","note.ts","Roll.tsx","App.tsx","index.tsx"],"names":["Stave","note","ref","useRef","useEffect","VF","Vex","Flow","div","document","querySelector","renderer","Renderer","Backends","SVG","resize","context","getContext","stave","addClef","setContext","draw","vfNote","StaveNote","clef","keys","octave","duration","accidental","addAccidental","Accidental","x_shift","voice","Voice","num_beats","beat_value","setMode","Mode","SOFT","addTickables","Formatter","joinVoices","format","current","svg","remove","className","id","notesNumber","Note","midi","str","this","letter","Math","floor","s","length","noteNumber","playing","withAudio","cb","audio","toString","Error","startNote","find","p","eq","push","currentTime","play","endNote","_","last","pause","playNote","a","Promise","res","setTimeout","keyToNote","key","65","87","83","69","68","70","84","71","89","72","85","74","75","79","76","80","186","fromString","Roll","onKey","keyDown","e","keyCode","classList","add","keyUp","window","addEventListener","removeEventListener","mouseDown","useCallback","target","noteStr","dataset","then","onMouseDown","data-key","data-note","App","useState","setNote","result","setResult","played","nextNote","fromNumber","random","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.33745b2b.chunk.js","sourcesContent":["import react, { useEffect, useRef } from 'react';\nimport Vex from 'vexflow';\nimport { Note } from './note';\n\nexport function Stave({note}: {note: Note}) {\n    const ref = useRef<HTMLDivElement>(null);\n    useEffect(() => {\n        const VF = Vex.Flow;\n        const div = document.querySelector('#stave') as HTMLElement;\n        var renderer = new VF.Renderer(div, VF.Renderer.Backends.SVG);\n        renderer.resize(150, 200);\n        var context = renderer.getContext();\n        var stave = new VF.Stave(10, 40, 100);\n\n        stave.addClef(\"treble\");\n        stave.setContext(context).draw();\n        const vfNote = new VF.StaveNote({clef: \"treble\", keys: [note.note+'/'+note.octave], duration: \"1\" });\n        if (note.accidental) {\n            vfNote.addAccidental(0, new VF.Accidental(note.accidental))\n        }\n        vfNote.x_shift = 9;\n        var voice = new VF.Voice({num_beats: 4,  beat_value: 4}).setMode(VF.Voice.Mode.SOFT);\n        voice.addTickables([vfNote]);\n        var formatter = new VF.Formatter().joinVoices([voice]).format([voice], 150);\n        voice.draw(context, stave);\n\n        return () => {\n            if (ref.current) {\n                const svg = ref.current.querySelector('svg')\n                svg && svg.remove();\n            }\n        }\n    }, [note])\n    return <div className=\"stave\" id=\"stave\" ref={ref}>\n\n    </div>\n}","import _ from 'lodash';\nimport { resolve } from 'path';\n\nconst notesNumber: any = {\n    'C': 1,\n    'C#': 2,\n    'Db': 2,\n    'D': 3,\n    'D#': 4,\n    'Eb': 4,\n    'E': 5,\n    'F': 6,\n    'F#': 7,\n    'Gb': 7,\n    'G': 8,\n    'G#': 9,\n    'Ab': 9,\n    'A': 10,\n    'A#': 11,\n    'Bb': 11,\n    'B': 12,\n}\n\nexport function randomNote(): Note {\n    return Note.fromNumber(_.random(60, 72))\n}\n\nexport class Note {\n    static fromNumber(midi: number) {\n        const letters = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n        const letter = letters[midi % 12];\n        const octave = Math.floor(midi / 12) - 1;\n        const accidental = letter[1] || null;\n        return new Note(midi, letter + octave, accidental, letter, octave);\n    }\n\n    static fromString(s: string) {\n        const note = s.length === 3 ? s[0] + s[1] : s[0];\n        const noteNumber = notesNumber[note] - 1;\n        const octave = +s[s.length - 1];\n        const midi = (noteNumber) + 12*(octave + 1);\n        const accidental = (s[1] === 'b' || s[1] === '#') ? s[1] : null;\n        return new Note(midi, s, accidental, note, octave);\n    }\n    constructor(\n        public midi: number,\n        public str: string,\n        public accidental: string | null,\n        public note: string,\n        public octave: number) {}\n\n    eq(note: Note) {\n        return this.midi === note.midi;\n    }\n\n    toString() {\n        return this.str;\n    }\n}\n\n\nlet playing: Note[] = [];\nfunction withAudio(note: Note, cb: (audio: HTMLAudioElement) => void) {\n    const audio: HTMLAudioElement | null = document.querySelector(`audio[data-note=\"${note.toString()}\"]`);\n    if (audio) {\n        cb(audio);\n    } else {\n        throw new Error('Cannot find <audio> for note ' + note.toString());\n    }\n}\nexport function startNote(note: Note) {\n    withAudio(note, audio => {\n        if (!playing.find(p => p.eq(note))) {\n            playing.push(note);\n            audio.currentTime = 0;\n            audio.play();\n        }\n    });\n}\nexport function endNote(note?: Note) {\n    note = note || _.last(playing);\n    if (note) {\n        withAudio(note, audio => {\n            audio.currentTime = 0;\n            audio.pause();\n            _.remove(playing, p => p.eq(note!));\n        });\n    }\n}\nexport async function playNote(note: Note): Promise<void> {\n    startNote(note);\n    return new Promise(res => {\n        setTimeout(() => {\n            endNote(note)\n            res();\n        }, 500)\n    })\n}","import _ from 'lodash';\nimport react, { useCallback, useEffect } from 'react';\nimport { endNote, Note, playNote, startNote } from './note';\nimport './Roll.css';\n\nfunction keyToNote(key: number) {\n    const keyMap: any = {\n        65: \"C4\",\n        87: \"C#4\",\n        83: \"D4\",\n        69: \"D#4\",\n        68: \"E4\",\n        70: \"F4\",\n        84: \"F#4\",\n        71: \"G4\",\n        89: \"G#4\",\n        72: \"A4\",\n        85: \"A#4\",\n        74: \"B4\",\n        75: \"C5\",\n        79: \"C#5\",\n        76: \"D5\",\n        80: \"D#5\",\n        186: \"E5\",\n    }\n    const res = keyMap[key];\n    if (res) return Note.fromString(res);\n    else throw new Error('Undefined key pressed ' + key)\n}\nlet mouseNote: Note | null = null;\nexport function Roll({onKey}: {onKey: (e: Note) => void} ) {\n    useEffect(() => {\n        window.addEventListener(\"keydown\", keyDown);\n        window.addEventListener('keyup', keyUp);\n\n        function keyDown(e: KeyboardEvent) {\n            const key = document.querySelector(`.key[data-key=\"${e.keyCode}\"]`);\n            if (!key) return;\n            key.classList.add(\"playing\");\n            startNote(keyToNote(e.keyCode))\n        }\n        function keyUp(e: KeyboardEvent) {\n            const key: any = document.querySelector(`.key[data-key=\"${e.keyCode}\"]`);\n            if (!key) return;\n            key.classList.remove(\"playing\");\n            const note = keyToNote(e.keyCode);\n            endNote(note)\n            onKey(note)\n        }\n        return () => {\n            window.removeEventListener(\"keydown\", keyDown);\n            window.removeEventListener('keyup', keyUp);\n        }\n    }, [onKey]);\n\n    const mouseDown = useCallback(function (e: any) {\n        const target = e.target as HTMLElement;\n        const noteStr = target.dataset.note\n        if (noteStr) {\n            const note = Note.fromString(noteStr);\n            startNote(note);\n            target.classList.add('playing');\n            mouseNote = note;\n            playNote(note).then(() => {\n                target.classList.remove('playing')\n                onKey(note);\n            });\n        }\n    }, [onKey]);\n\n    return (\n<section id=\"main\">\n    <div className=\"nowplaying\"></div>\n    <div className=\"keys\" onMouseDown={mouseDown}>\n      <div data-key=\"65\" className=\"key\" data-note=\"C4\">\n          <span className=\"hints\">A</span>\n      </div>\n      <div data-key=\"87\" className=\"key sharp\" data-note=\"C#4\">\n          <span className=\"hints\">W</span>\n      </div>\n      <div data-key=\"83\" className=\"key\" data-note=\"D4\">\n          <span className=\"hints\">S</span>\n      </div>\n      <div data-key=\"69\" className=\"key sharp\" data-note=\"D#4\">\n          <span className=\"hints\">E</span>\n      </div>\n      <div data-key=\"68\" className=\"key\" data-note=\"E4\">\n          <span className=\"hints\">D</span>\n      </div>\n      <div data-key=\"70\" className=\"key\" data-note=\"F4\">\n          <span className=\"hints\">F</span>\n      </div>\n      <div data-key=\"84\" className=\"key sharp\" data-note=\"F#4\">\n          <span className=\"hints\">T</span>\n      </div>\n      <div data-key=\"71\" className=\"key\" data-note=\"G4\">\n          <span className=\"hints\">G</span>\n      </div>\n      <div data-key=\"89\" className=\"key sharp\" data-note=\"G#4\">\n          <span className=\"hints\">Y</span>\n      </div>\n      <div data-key=\"72\" className=\"key\" data-note=\"A4\">\n          <span className=\"hints\">H</span>\n      </div>\n      <div data-key=\"85\" className=\"key sharp\" data-note=\"A#4\">\n          <span className=\"hints\">U</span>\n      </div>\n      <div data-key=\"74\" className=\"key\" data-note=\"B4\">\n          <span className=\"hints\">J</span>\n      </div>\n      <div data-key=\"75\" className=\"key\" data-note=\"C5\">\n          <span className=\"hints\">K</span>\n      </div>\n      <div data-key=\"79\" className=\"key sharp\" data-note=\"C#5\">\n          <span className=\"hints\">O</span>\n      </div>\n      <div data-key=\"76\" className=\"key\" data-note=\"D5\">\n          <span className=\"hints\">L</span>\n      </div>\n      <div data-key=\"80\" className=\"key sharp\" data-note=\"D#5\">\n          <span className=\"hints\">P</span>\n      </div>\n      <div data-key=\"186\" className=\"key\" data-note=\"E5\">\n          <span className=\"hints\">;</span>\n      </div>\n    </div>\n</section>)\n}\n\n","import React, { useCallback, useEffect, useState } from 'react';\nimport './App.css';\nimport { Stave } from './stave';\nimport {Note, playNote, randomNote} from './note';\nimport { Roll } from './Roll';\n\nfunction App() {\n  const [note, setNote] = useState(Note.fromString('C4'));\n  const [result, setResult] = useState('?');\n  useEffect(() => {\n    playNote(note);\n  }, [note]);\n  const onKey = useCallback((played: Note) => {\n    if (played.eq(note)) {\n      setResult(note.toString());\n      setTimeout(() => {\n        setResult('?');\n        const nextNote = randomNote();\n        setNote(nextNote)\n      }, 500)\n    }\n  }, [note])\n  return (\n    <div className=\"App\">\n      <Stave note={note}/>\n      <h1>{result}</h1>\n      <Roll onKey={onKey} />\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);"],"sourceRoot":""}